{
  "research_area": "Metagenomics",
  "description": "Metagenomics is the study of genetic material recovered directly from environmental samples. It enables the analysis of microbial communities without the need for culturing individual species. This field has expanded rapidly with advances in high-throughput sequencing technologies, allowing researchers to study complex microbiomes and their roles in environmental and health contexts.",
  "key_concepts": [
    "Microbial community profiling (taxonomic classification)",
    "Alpha and beta diversity analysis",
    "Shotgun metagenomics vs. amplicon sequencing (16S, ITS)",
    "Functional annotation and pathway analysis",
    "Metagenome assembly and binning",
    "Microbiome-host interactions",
    "Environmental metagenomics",
    "Human microbiome analysis"
  ],
  "common_tools": [
    "QIIME/QIIME2 - Microbiome analysis pipeline",
    "MetaPhlAn - Profiling composition of microbial communities",
    "Kraken2/Bracken - Taxonomic classification of metagenomics reads",
    "DADA2 - Amplicon sequence variant inference",
    "SPAdes/MEGAHIT - Metagenomic assembly",
    "MetaBAT/MaxBin - Metagenomic binning",
    "MG-RAST - Metagenome annotation server",
    "HUMAnN - Functional profiling of microbial communities",
    "mothur - 16S rRNA gene analysis"
  ],
  "common_file_formats": [
    {
      "name": "FASTQ",
      "description": "Raw sequencing reads with quality scores"
    },
    {
      "name": "FASTA",
      "description": "Nucleotide or protein sequences without quality scores"
    },
    {
      "name": "BIOM",
      "description": "Biological Observation Matrix for storing taxon/OTU tables"
    },
    {
      "name": "QIIME2 Artifact (.qza)",
      "description": "QIIME2-specific data format with provenance tracking"
    },
    {
      "name": "Phylogenetic trees (.nwk, .tre)",
      "description": "Newick format for phylogenetic trees"
    },
    {
      "name": "OTU/ASV tables",
      "description": "Tables of Operational Taxonomic Units or Amplicon Sequence Variants"
    }
  ],
  "examples": [
    {
      "query": "How do I analyze 16S rRNA amplicon data from human gut microbiome samples?",
      "context": "The user has paired-end Illumina sequences targeting the V3-V4 region of the 16S rRNA gene from 50 human gut samples (25 healthy controls, 25 IBD patients).",
      "response": "\nTo analyze 16S rRNA amplicon data from human gut microbiome samples, I recommend using QIIME2 with the following workflow:\n\n1. Import your raw data into QIIME2 format:\n   ```bash\n   # For paired-end reads\n   qiime tools import      --type 'SampleData[PairedEndSequencesWithQuality]'      --input-path manifest.tsv      --output-path paired-end-demux.qza      --input-format PairedEndFastqManifestPhred33V2\n   ```\n\n2. Generate sequence quality plots to determine trimming parameters:\n   ```bash\n   qiime demux summarize      --i-data paired-end-demux.qza      --o-visualization demux-summary.qzv\n   ```\n\n3. Denoise with DADA2 to obtain ASVs (Amplicon Sequence Variants):\n   ```bash\n   qiime dada2 denoise-paired      --i-demultiplexed-seqs paired-end-demux.qza      --p-trim-left-f 17 --p-trim-left-r 21      --p-trunc-len-f 280 --p-trunc-len-r 230      --o-table table.qza      --o-representative-sequences rep-seqs.qza      --o-denoising-stats denoising-stats.qza      --p-n-threads 0\n   ```\n\n4. Generate a phylogenetic tree for diversity analyses:\n   ```bash\n   qiime phylogeny align-to-tree-mafft-fasttree      --i-sequences rep-seqs.qza      --o-alignment aligned-rep-seqs.qza      --o-masked-alignment masked-aligned-rep-seqs.qza      --o-tree unrooted-tree.qza      --o-rooted-tree rooted-tree.qza\n   ```\n\n5. Assign taxonomy using a reference database (Silva or Greengenes):\n   ```bash\n   qiime feature-classifier classify-sklearn      --i-classifier silva-138-99-515-806-nb-classifier.qza      --i-reads rep-seqs.qza      --o-classification taxonomy.qza\n   ```\n\n6. Create taxonomy visualization:\n   ```bash\n   qiime metadata tabulate      --m-input-file taxonomy.qza      --o-visualization taxonomy.qzv\n   \n   qiime taxa barplot      --i-table table.qza      --i-taxonomy taxonomy.qza      --m-metadata-file sample-metadata.tsv      --o-visualization taxa-bar-plots.qzv\n   ```\n\n7. Perform alpha and beta diversity analyses:\n   ```bash\n   qiime diversity core-metrics-phylogenetic      --i-phylogeny rooted-tree.qza      --i-table table.qza      --p-sampling-depth 10000      --m-metadata-file sample-metadata.tsv      --output-dir core-metrics-results\n   ```\n\n8. Test for differential abundance between IBD and healthy controls:\n   ```bash\n   qiime composition add-pseudocount      --i-table table.qza      --o-composition-table comp-table.qza\n     \n   qiime composition ancom      --i-table comp-table.qza      --m-metadata-file sample-metadata.tsv      --m-metadata-column disease_status      --o-visualization ancom-disease_status.qzv\n   ```\n\n9. For more detailed differential abundance analysis, use alternative methods:\n   ```bash\n   # Using the q2-aldex2 plugin\n   qiime aldex2 aldex2      --i-table table.qza      --m-metadata-file sample-metadata.tsv      --m-metadata-column disease_status      --o-visualization aldex2-disease_status.qzv\n   ```\n\nKey considerations:\n- Adjust trimming parameters based on your quality profiles\n- Choose a sampling depth that balances retained samples vs. sequence depth\n- Consider batch effects if samples were processed in different runs\n- Verify that your metadata file contains all necessary variables (treatment, age, gender, etc.)\n- For human gut microbiome analysis, track dietary information and medication use when possible\n"
    },
    {
      "query": "What's the best approach for taxonomic and functional profiling of shotgun metagenomic data?",
      "context": "The user has shotgun metagenomic data from soil samples and wants to identify both the microbial composition and metabolic potential of the community.",
      "response": "\nFor taxonomic and functional profiling of shotgun metagenomic data from soil samples, I recommend this comprehensive workflow:\n\n1. Quality control and preprocessing:\n   ```bash\n   # Trim adapters and low-quality sequences\n   trimmomatic PE raw_reads_1.fastq.gz raw_reads_2.fastq.gz      clean_1.fastq.gz unpaired_1.fastq.gz      clean_2.fastq.gz unpaired_2.fastq.gz      ILLUMINACLIP:TruSeq3-PE.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:50\n   \n   # Remove host contamination if relevant\n   bowtie2 -x host_genome -1 clean_1.fastq.gz -2 clean_2.fastq.gz --un-conc-gz filtered_%.fastq.gz\n   ```\n\n2. Taxonomic profiling with multiple tools for robustness:\n   ```bash\n   # Using Kraken2 + Bracken for taxonomic classification\n   kraken2 --db kraken2_db --paired filtered_1.fastq.gz filtered_2.fastq.gz      --output kraken2_output.txt --report kraken2_report.txt\n   \n   bracken -d kraken2_db -i kraken2_report.txt -o bracken_output.txt -r 150 -l S\n   \n   # Using MetaPhlAn for strain-level profiling\n   metaphlan filtered_1.fastq.gz,filtered_2.fastq.gz      --input_type fastq --bowtie2out metagenome.bowtie2.bz2      --nproc 16 --output_file metaphlan_profile.txt\n   ```\n\n3. Functional profiling:\n   ```bash\n   # Using HUMAnN3 for metabolic pathway analysis\n   humann --input filtered_1.fastq.gz --input-format fastq      --output humann_output --nucleotide-database chocophlan      --protein-database uniref90 --threads 16\n   \n   # Normalize and join tables if you have multiple samples\n   humann_renorm_table --input humann_output/genefamilies.tsv      --output humann_output/genefamilies_relab.tsv --units relab\n   \n   humann_join_tables --input humann_output/ --output all_samples_genefamilies.tsv      --file_name genefamilies_relab\n   \n   humann_join_tables --input humann_output/ --output all_samples_pathabundance.tsv      --file_name pathabundance_relab\n   ```\n\n4. For soil metagenomes specifically, consider assembly and binning:\n   ```bash\n   # Assembly with MEGAHIT\n   megahit -1 filtered_1.fastq.gz -2 filtered_2.fastq.gz -o assembly --min-contig-len 1000\n   \n   # Map reads back to assembly\n   bowtie2-build assembly/final.contigs.fa assembly_index\n   bowtie2 -x assembly_index -1 filtered_1.fastq.gz -2 filtered_2.fastq.gz |      samtools view -bS - > mapped.bam\n   samtools sort mapped.bam -o sorted.bam\n   samtools index sorted.bam\n   \n   # Binning with MetaBAT2\n   jgi_summarize_bam_contig_depths --outputDepth depth.txt sorted.bam\n   metabat2 -i assembly/final.contigs.fa -a depth.txt -o bins/bin\n   ```\n\n5. Functional annotation of assembled contigs:\n   ```bash\n   # Predict genes using Prodigal\n   prodigal -i assembly/final.contigs.fa -a proteins.faa -d genes.fna -p meta\n   \n   # Annotate with eggNOG-mapper\n   emapper.py -i proteins.faa --output eggnog_output -m diamond\n   \n   # Or use more soil-specific databases like KEGG or CAZy\n   diamond blastp --db kegg.dmnd --query proteins.faa --out kegg_hits.tsv\n   ```\n\n6. Advanced soil-specific analysis:\n   ```bash\n   # Identify antimicrobial resistance genes\n   abricate --db card assembly/final.contigs.fa > amr_genes.tab\n   \n   # Nitrogen cycle genes\n   hmmsearch --tblout nitrogen_cycle.hits nitrogen_cycle_hmms.hmm proteins.faa\n   ```\n\n7. Visualize and integrate results:\n   ```bash\n   # Generate Krona charts for taxonomy\n   ktImportTaxonomy -q 2 -t 3 kraken2_output.txt -o kraken2_taxonomy.html\n   \n   # Visualize functional pathways using Cytoscape or R\n   Rscript -e \"library(ggplot2); library(reshape2); data <- read.table('all_samples_pathabundance.tsv', header=TRUE, sep='\t'); ...\"\n   ```\n\nKey considerations for soil metagenomes:\n- Soil has extremely high microbial diversity; adjust parameters accordingly\n- Be aware of extraction biases with soil samples\n- Consider using specialized soil microbiome databases for better annotations\n- Track soil properties (pH, moisture, nutrients) as metadata for correlations\n- For ecological interpretation, focus on functional pathways relevant to soil processes (carbon cycling, nitrogen fixation)\n"
    },
    {
      "query": "How can I recover Metagenome-Assembled Genomes (MAGs) from my environmental samples?",
      "context": "The user has deep shotgun metagenomic sequencing (~100Gb) from 5 hot spring samples and wants to recover high-quality microbial genomes.",
      "response": "\nHere's a comprehensive workflow for recovering high-quality Metagenome-Assembled Genomes (MAGs) from your hot spring samples:\n\n1. Quality control and preprocessing:\n   ```bash\n   # For each sample\n   fastp -i raw_reads_1.fastq.gz -I raw_reads_2.fastq.gz      -o clean_1.fastq.gz -O clean_2.fastq.gz      --detect_adapter_for_pe --correction --cut_right      --cut_window_size 4 --cut_mean_quality 20 --html fastp_report.html\n   ```\n\n2. Assemble each sample individually:\n   ```bash\n   # Using MEGAHIT for each sample\n   for sample in sample1 sample2 sample3 sample4 sample5; do\n     megahit -1 ${sample}_clean_1.fastq.gz -2 ${sample}_clean_2.fastq.gz        -o assembly_${sample} --min-contig-len 2000        --k-min 27 --k-max 127 --k-step 10 --memory 0.8 --num-cpu-threads 32\n   done\n   ```\n\n3. Map reads back to their respective assemblies:\n   ```bash\n   # For each sample\n   for sample in sample1 sample2 sample3 sample4 sample5; do\n     # Build index\n     bowtie2-build assembly_${sample}/final.contigs.fa ${sample}_index\n     \n     # Map reads\n     bowtie2 -x ${sample}_index -1 ${sample}_clean_1.fastq.gz -2 ${sample}_clean_2.fastq.gz |        samtools view -bS - > ${sample}_mapped.bam\n     \n     # Sort and index\n     samtools sort ${sample}_mapped.bam -o ${sample}_sorted.bam\n     samtools index ${sample}_sorted.bam\n   done\n   ```\n\n4. Perform binning with multiple tools and co-assembly approach:\n   ```bash\n   # For individual samples first\n   for sample in sample1 sample2 sample3 sample4 sample5; do\n     # MetaBAT2\n     jgi_summarize_bam_contig_depths --outputDepth ${sample}_depth.txt ${sample}_sorted.bam\n     metabat2 -i assembly_${sample}/final.contigs.fa -a ${sample}_depth.txt -o bins_metabat/${sample}_bin\n     \n     # MaxBin2\n     run_MaxBin.pl -contig assembly_${sample}/final.contigs.fa -out bins_maxbin/${sample}_bin        -reads1 ${sample}_clean_1.fastq.gz -reads2 ${sample}_clean_2.fastq.gz -thread 16\n     \n     # CONCOCT\n     cut_up_fasta.py assembly_${sample}/final.contigs.fa -c 10000 -o 0 --merge_last -b ${sample}_contigs_10K.bed > ${sample}_contigs_10K.fa\n     concoct_coverage_table.py ${sample}_contigs_10K.bed ${sample}_sorted.bam > ${sample}_coverage_table.tsv\n     concoct --composition_file ${sample}_contigs_10K.fa --coverage_file ${sample}_coverage_table.tsv -b concoct_output/${sample}\n   done\n   \n   # Optional: Also try co-assembly for closely related samples\n   cat sample1_clean_1.fastq.gz sample2_clean_1.fastq.gz > coassembly_R1.fastq.gz\n   cat sample1_clean_2.fastq.gz sample2_clean_2.fastq.gz > coassembly_R2.fastq.gz\n   megahit -1 coassembly_R1.fastq.gz -2 coassembly_R2.fastq.gz -o assembly_coassembly --min-contig-len 2000\n   ```\n\n5. Use DASTool to integrate and optimize bins from different binners:\n   ```bash\n   for sample in sample1 sample2 sample3 sample4 sample5; do\n     # Convert binning results to DASTool format\n     Fasta_to_Contig2Bin.sh -i bins_metabat/${sample}_bin -e fa > ${sample}_metabat_contigs2bin.tsv\n     Fasta_to_Contig2Bin.sh -i bins_maxbin/${sample}_bin -e fasta > ${sample}_maxbin_contigs2bin.tsv\n     perl scripts/concoct_bins_to_dastool.pl concoct_output/${sample}_clustering_gt1000.csv > ${sample}_concoct_contigs2bin.tsv\n     \n     # Run DASTool\n     DAS_Tool -i ${sample}_metabat_contigs2bin.tsv,${sample}_maxbin_contigs2bin.tsv,${sample}_concoct_contigs2bin.tsv        -c assembly_${sample}/final.contigs.fa -o dastool_output/${sample}        --write_bins 1 --write_unbinned 1 --threads 16\n   done\n   ```\n\n6. Assess bin quality with CheckM and GTDB-Tk:\n   ```bash\n   # CheckM for completeness and contamination\n   checkm lineage_wf dastool_output/sample1_DASTool_bins/ checkm_output/sample1 -x fa -t 16\n   \n   # GTDB-Tk for taxonomic classification\n   gtdbtk classify_wf --genome_dir dastool_output/sample1_DASTool_bins/      --out_dir gtdbtk_output/sample1 --extension fa --cpus 16\n   ```\n\n7. Filter for high-quality MAGs:\n   ```bash\n   # Create a list of high-quality MAGs (>90% completeness, <5% contamination)\n   checkm qa checkm_output/sample1/lineage.ms checkm_output/sample1 -o 2 -f high_quality_mags.tsv --tab_table\n   \n   # Filter based on quality metrics\n   awk -F'\t' '($13 >= 90) && ($14 <= 5) {print $1}' high_quality_mags.tsv > high_quality_mags_list.txt\n   ```\n\n8. Improve bin quality with post-binning refinement (optional):\n   ```bash\n   # Use MetaWRAP's bin refinement module for problematic bins\n   metawrap bin_refinement -o bin_refinement      -t 16      -A bins_metabat/${sample}_bin      -B bins_maxbin/${sample}_bin      -C concoct_output/${sample}_bins      -c 70 -x 10\n   ```\n\n9. Annotate MAGs for functional analysis:\n   ```bash\n   # Predict genes\n   for mag in high_quality_mags/*.fa; do\n     basename=$(basename $mag .fa)\n     prodigal -i $mag -a ${basename}_proteins.faa -d ${basename}_genes.fna -p single\n   done\n   \n   # Annotate with KEGG\n   for protein in high_quality_mags/*_proteins.faa; do\n     basename=$(basename $protein _proteins.faa)\n     kofamscan -o ${basename}_kofam.txt -p /path/to/profiles -k /path/to/ko_list $protein\n   done\n   ```\n\nKey considerations for hot spring MAGs:\n- Hot springs often harbor unique thermophilic microbes; consider reference databases that include thermophiles\n- Be aware that some hot spring microbes have unusual genomic properties (e.g., high GC content)\n- co-assembly may work well for similar hot spring samples but could complicate binning if communities differ significantly\n- Use stricter quality thresholds for publication-quality MAGs (>95% completion, <5% contamination)\n- Consider dereplication if you recover similar MAGs across samples (using dRep)\n- For thermophilic environments, specialized analyses of heat-stable enzymes might be valuable\n"
    }
  ],
  "references": [
    "Quince C, et al. (2017). Shotgun metagenomics, from sampling to analysis. Nature Biotechnology.",
    "Bolyen E, et al. (2019). Reproducible, interactive, scalable and extensible microbiome data science using QIIME 2. Nature Biotechnology.",
    "Franzosa EA, et al. (2018). Species-level functional profiling of metagenomes and metatranscriptomes. Nature Methods.",
    "Kang DD, et al. (2019). MetaBAT 2: an adaptive binning algorithm for robust and efficient genome reconstruction from metagenome assemblies. PeerJ."
  ]
}